---
title: "Uso do R nos Levantamentos Geoqu√≠micos"
author: "Viviane Carillo Ferrari"

format: 
  revealjs:
    logo: "images/logo.png"
    width: 1600
    height: 900
    self-contained: true
    incremental: false
    footer: "Slides [on GitHub](https://github.com/VivianeCF/R4geoch.git)."
    theme: ["custom.scss"]
    slide-number: c/t
    show-slide-number: all
    hash-type: number
    preview-links: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
 #set to two decimal 
require(magrittr)

```

## Introdu√ß√£o

Sejam bem vindos, estou muito contente pelo interesse de voc√™s. üòç\

O fluxo de trabalho apresentado aqui abrange as tarefas iniciais de um projeto de levantamento geoqu√≠mico desenvolvido no SGB.\

Utilizo como exemplo os dados do levantamento da folha Eldorado Paulista levantada em 2008.

## Objetivos

A proposta aqui √© mostrar um caminho mais f√°cil de usar as ferramentas do R, disponibilizadas na forma de um pacote do R desenvolvido para geoqu√≠micos.

Hoje o pacote [`digeoqR`](https://github.com/VivianeCF/digeoqR.git) j√° reune algumas funcionalidades muito interessantes.\

No futuro pretendo reunir mais fun√ß√µes.\

Aqui tento lan√ßar uma semente para os futuros colaboradores deste ou de outros pacotes.\

Espero tornar o R uma ferramenta de apoio aos trabalhos dos geoqu√≠micos do SGB-CPRM.\

## Conte√∫do

1.  Introdu√ß√£o a linguagem R

2.  Uso do R no levantamento geoqu√≠mico

3.  Fechamento

## 1. Introdu√ß√£o a linguagem R

::: columns
::: {.column width="50%" style="font-size: 30px"}
1.  [O que √© R?](#r)

    -   Por que usar R?
    -   √â √∫til programar?
    -   CRAN

2.  [Instala√ß√£o e estrutura](#instalacao-e-estrutura)

    -   Instala√ß√£o

    -   Sess√£o

    -   Vers√µes

3.  [Estilos de programa√ß√£o](#estilo_de_programacao)

    -   Scripts

    -   Regras
:::

::: {.column width="50%" style="font-size: 30px"}
4.  [Pacotes](#pacotes)

    -   Instala√ß√£o

    -   Pacotes pr√©-instalados e rota de busca

    -   Recursos

5.  [Ajuda em R](#ajuda-em-r)

    -   Interna

    -   Externa

6.  [Iniciar sess√£o no R](#iniciar-sessao-no-r)

    -   Alguns comandos b√°sicos

    -   options()

    -   Erros e advert√™ncias

    -   Uso de fun√ß√µes
:::
:::

##

### O que √© R? {#r}

::: incremental
-   R √© uma linguagem de programa√ß√£o interpretada de c√≥digo aberto. N√£o √© compilada e √© executada passo a passo por um programa que interpreta os resultados.

-   R √© uma linguagem de progama√ß√£o orientada a manipula√ß√£o de dados, an√°lise estat√≠stica e visualiza√ß√£o gr√°fica dos dados.

-   Em 1993 o R foi criado como um dialeto da linguagem S desenvolvida por [John Chambers](https://www.r-bloggers.com/2014/01/john-chambers-recounts-the-history-of-s-and-r/) e colaboradores.

-   Os nomes importantes nesta hist√≥ria s√£o muitos, mas os principais s√£o: [Robert Gentleman](https://en.wikipedia.org/wiki/Robert_Gentleman/statistician) e [Ross Ihaka](https://www.stat.auckland.ac.nz/~ihaka/). A hit√≥ria do R pode ser vista [aqui](https://cran.r-project.org/doc/html/interface98-paper/paper_2.html).

-   Em 1995, [Martin M√§chler](https://people.math.ethz.ch/~maechler/) deu uma contribui√ß√£o importante ao convencer Ross e Robert a usar a Licen√ßa P√∫blica Geral [GNU](https://gnu.org/licenses/gpl-3.0.html) (General Public Licenses) para tornar o R um software livre. A vers√£o 1.0.0 do R s√≥ foi lan√ßada em fevereiro de 2000.
:::

## 

#### Por que Usar R? {#sec-porque-usar-r}

Algumas das muitas raz√µes:

::: {.incremental style="line-height: 1.8"}
1.  √â gratuito

2.  Funciona em m√∫ltiplas plataformas (Windows, MAC, Linux)

3.  Replicabilidade

4.  Atualiza√ß√£o das √∫ltimas t√©cnicas estat√≠sticas

5.  Est√° em constante desenvolvimento

6.  Ferramenta poderosa para cria√ß√£o de gr√°ficos

7.  Integra√ß√£o com outras linguagens: LATEX, C++, Python, Julia, Stan...
:::

## 

::: {#pq_R style="color: blue; fonte-size: 50px"}
::: {style="color: black; font-size: 50px; text-align: center;"}
\
\

E uma raz√£o fundamental:\
\
Conta com uma comunidade muito ativa.

\
\
:::
:::

::: {#razao_R style="font-size: 50px; text-align: center;"}
"When you talk about choosing programming languages, I always say you shouldn't pick them based on technical merits, but rather pick them based on the community."
:::

::: {style="font-size: 50px; text-align: right;"}
[Hadley Wickham](https://www.r-bloggers.com/2018/08/advice-to-young-and-old-programmers-a-conversation-with-hadley-wickham/)
:::

## 

#### Por que programar?

::: {style="font-size: 50px; line-height: 200%;"}
-   Melhora a organiza√ß√£o das ideias.
-   Aumenta a criatividade para resolver problemas.
-   Torna a solu√ß√£o dos problemas mais eficiente.
:::

## 

#### CRAN {#sec-informa√ß√£o-sobre-r-e-o-cran}

CRAN (The Comprehensive R Archive Network) √© uma rede ftp (File Transfer Protocol) que contem toda a informa√ß√£o sobre R e seus pacotes.\
Na p√°gina (<https://cran.r-project.org>) se encontram todas as informa√ß√µes nesess√°rias para iniciar-se em R:

::: {#info_r style="margin-left: 10%;"}
-   [Manuais principais](https://cran.r-project.org/manuals.html)

-   [Pol√≠ticas do reposit√≥rio](https://cran.r-project.org/web/packages/policies.html)

-   [Livros relacionados com S e R em v√°rios idiomas](https://cran.r-project.org/other-docs.html)

-   [Jornal do R](https://journal.r-project.org/)
:::

## 

#### Outros locais de informa√ß√£o

Informa√ß√µes relevantes sobre R podem ser encontradas em:

::: {#other_info style="margin-left: 10%"}
-   [Journal of Statistical Software](https://www.jstatsoft.org/index)

-   [Tend√™ncias atuais no GitHub](https://github.com/trending/r?since=monthly)

-   [R-blogger](https://www.r-bloggers.com/)
:::

##

### Instala√ß√£o e estrutura {#instalacao-e-estrutura}

1.  Download

-   Download e instru√ß√µes de instala√ß√£o do R: <https://cran.r-project.org/>\
-   Download e instru√ß√µes de instala√ß√£o do RStudio: <https://posit.co/download/rstudio-desktop/>

2.  Atualiza√ß√£o do R

```{r instal_windows, eval = FALSE, include=TRUE, echo=TRUE}
install.packages("installr")
installr::updateR()
```

## R online
-   Este modo de rodar o R √© executado de maneira mais lenta, com pouco processamento e sem poder carregar pacotes: <https://rdrr.io/snippets/>

## 

#### Mensagem inicial da sess√£o do R {style="font-size: 50px;"}

```{r mensagem R, eval = FALSE, include=TRUE, echo=TRUE, `code-line-numbers`="1-3|5-7|9-11|13-15"}

R version 4.3.2 (2023-10-31 ucrt) -- "Eye Holes"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R √© um software livre e vem sem GARANTIA ALGUMA.
Voc√™ pode redistribu√≠-lo sob certas circunst√¢ncias.
Digite 'license()' ou 'licence()' para detalhes de distribui√ß√£o.

R √© um projeto colaborativo com muitos contribuidores.
Digite 'contributors()' para obter mais informa√ß√µes e
'citation()' para saber como citar o R ou pacotes do R em publica√ß√µes.

Digite 'demo()' para demonstra√ß√µes, 'help()' para o sistema on-line de ajuda,
ou 'help.start()' para abrir o sistema de ajuda em HTML no seu navegador.
Digite 'q()' para sair do R.

```

## 

+--------------------------------------------------------------------------------------------+
| ### ![](images/iconR.jpg){fig-align="left" width="100"} Sess√£o do RGui {style="fig-align"} |
+--------------------------------------------------------------------------------------------+

![](images/Rgui.PNG){fig-align="center"}

## 

+-----------------------------------------------------------------------------------------------------+
| ### ![](images/iconRStudio.jpg){fig-align="left" width="100"} Sess√£o do RStudio {style="fig-align"} |
+-----------------------------------------------------------------------------------------------------+

![](images/rstudio.PNG){fig-align="center" width="1200"}

## 

#### Pain√©is do RStudio

+------------+-------------------------------------------------------------------------------------------+
| Editor     | Local para desenvolvimento de scripts.                                                    |
+------------+-------------------------------------------------------------------------------------------+
| Console    | Imprime na tela as senten√ßas executadas a partir do editor ou diretamente no console      |
+------------+-------------------------------------------------------------------------------------------+
| Run        | Executa uma instru√ß√£o do editor (Ctrl+Enter) onde est√° o cursor ou o que est√° selecionado |
+------------+-------------------------------------------------------------------------------------------+
| Enviroment | Lista todos os objetos gerados em cada sess√£o                                             |
+------------+-------------------------------------------------------------------------------------------+
| History    | Hist√≥rico de execu√ß√£o                                                                     |
+------------+-------------------------------------------------------------------------------------------+
| Terminal   | Um terminal para conectar ao Git, por exemplo, entre outras coisas                        |
+------------+-------------------------------------------------------------------------------------------+
| Files      | Arquivos (dados, script) podem ser pesquisados neste painel                               |
+------------+-------------------------------------------------------------------------------------------+
| Plot       | Imprime os gr√°ficos                                                                       |
+------------+-------------------------------------------------------------------------------------------+
| Packages   | √â um gerenciador de pacotes instalados                                                    |
+------------+-------------------------------------------------------------------------------------------+
| Help       | Ajuda r√°pida                                                                              |
+------------+-------------------------------------------------------------------------------------------+

## 

#### Locais com instru√ß√µes e atalhos sobre a configura√ß√£o e uso

-   [Customizar o RStudio](https://support.posit.co/hc/en-us/articles/200549016-Customizing-the-RStudio-IDE)

-   [Comandos do hist√≥rico](https://support.posit.co/hc/en-us/articles/200526217-Command-History-in-the-RStudio-IDE)\

-   [Atalhos](https://support.posit.co/hc/en-us/articles/200404846-Working-in-the-Console-in-the-RStudio-IDE) para trabalhar no console.

\

## 

#### Verificando as vers√µes

Ao iniciar o R, aparecer√° no console a vers√£o que est√° em execu√ß√£o e o nome.\

\

```{r, echo=TRUE, eval = FALSE, `code-line-numbers`="1|3|6|9|11|14"}
R.Version() # Informa√ß√£o detalhada de vers√£o do R

R.Version()$version.string # N√∫mero e data da vers√£o
## [1] "R version 4.3.2 (2023-10-31 ucrt)"

R.Version()$nickname # Nome da vers√£o
## [1] "Eye Holes"

sessionInfo() # Informa√ß√£o detalhada da sess√£o atual

RStudio.Version()$version # Vers√£o do RStudio
## [1] ‚Äò2023.12.1.402‚Äô

Sys.info() ## Informa√ß√£o do sistema operacional

```

## 

#### Import√¢ncia do uso de scripts

Um script √© um arquivo de texto que cont√©m um conjunto de comandos ou instru√ß√µes. Esses comandos e instru√ß√µes s√£o executados sequencialmente no R.

::: {.incremental style="line-height: 1.8"}
-   **Prepara√ß√£o**: para criar esses arquivos √© importante para ter um hist√≥rico de trabalho.\

-   **Arquivo:** O nome do arquivo deve ser suficientemente claro para refletir o conte√∫do e encontr√°-lo facilmente. Se poss√≠vel deve ser curto e evitar o uso de `"."` .\

-   **Documenta√ß√£o**: √â muito importante comentar as opera√ß√µes ou fun√ß√µes utilizadas para poder replicar com facilidade o trabalho. Os coment√°rios devem come√ßar com `"#"`.\
:::

```{r, echo = TRUE, results='hide'}
X <- c(1, 8, 19)
# O objeto 'X' √© um vetor de tr√™s n√∫meros. 
# Isto √© um coment√°rio
```

##

### Estilos de programa√ß√£o {#estilo_de_programacao}

Existem diferentes maneiras de program,ar. √â importante ser cuidadoso na maneira de escrever seu c√≥digo para que seja f√°cil replicar e ler o c√≥digo.\

```{r, eval=FALSE, echo=TRUE}
## Mal escrito
media<-function (x){n<-length(x);sum(x)/n}

## Bem escrito
media <- function(x) {
        n <- length(x)
        sum(x) / n
}

```

## 

#### Guias de estilo de programa√ß√£o

-   O pacote [styler](https://cran.r-project.org/web/packages/styler/index.html) pode ser de grande ajuda

-   Guia de estilo de Hadley [aqui](http://adv-r.had.co.nz/Style.html)

-   Guia de estilo de Google [aqui](https://google.github.io/styleguide/Rguide.html)

##
### Pacotes {#pacotes}

Um pacote √© constitu√≠do por um conjunto de fun√ß√µes e arquivos de dados, devidamente documentados, que implementam uma ou mais t√©cnicas para tratamento e an√°lise de dados.

#### Instalar

```{r, echo = TRUE, eval=FALSE}
## Baixa um pacote do CRAN
install.packages("ggplot2")

## Baixa um pacote do GitHub (vers√£o de desenvolvimento do pacote)
install.packages("devtools")
devtools::install_github("VivianeCFerrari/digeoqR")

## O nome do pacote sempre deve estar entre aspas!
```

## 

#### Carregar

```{r, echo = TRUE, eval=FALSE}
## Para usar as fun√ß√µes de um pacote j√° instalado usar a fun√ß√£o:
## library(...)

library("digeoqR")
# Voc√™ pode dispensar o uso de aspas

library(digeoqR)
```

## 

#### Fun√ß√µes sobre os pacotes

```{r, echo = TRUE, eval = FALSE}
installed.packages() # lista pacotes instalados
packageStatus() # informa quantos pacotes n√£o est√£o atualizados
download.packages() # compara vers√µes dos pacotes instalados
                    # com os atuais no CRAN
available.packages() # lista todos os pacotes dispon√≠veis
update.packages() # atualiza pacotes
library(help="MASS") # Informa√ß√£o sobre um paquete espec√≠fico
demo("graphics") # Demonstra√ß√£o de um pacote
```

## 

A lista de pacotes anexados e objetos √© alterada com o carregamento de um pacote.

#### Estado inicial

```{r, echo=TRUE}
search()
```

#### Estado ap√≥s carregar um pacote

```{r, echo=TRUE}
library("MASS")
search()
```

## 

#### Documenta√ß√£o e recursos sobre os pacotes

-   [Lista de pacotes ativos](https://cran.r-project.org/web/packages/available_packages_by_name.html)
-   [Lista de pacotes por √°rea](https://cran.r-project.org/web/views/)
-   [Pacotes mais baixados](https://www.r-pkg.org/downloaded)

##
### Ajuda {#ajuda-em-r}

#### Conseguindo ajuda por si s√≥

```{r, echo=TRUE, eval=FALSE}
help(lm) # Comando b√°sico de busca
?lm # idem do anterior
help("+") # Ajuda sobre un operador
help.search("norm") # Busca entre os pacotes instalados as
# fun√ß√µes que contenham o termo "norm"
??norm # idem anterior
apropos("mean") # Lista de fun√ß√µes que contenham o termo "norm"
help(rlm, package="MASS") # Busca a ajuda de uma fun√ß√£o especifica
# de um pacote
RSiteSearch("glm") # Busca os manuais e arquivos de ajuda da web
# R-project
find("mean") # Devolve o pacote o qual pertenece a fun√ß√£o.
# (el pacote deve estar carregado: library())
example(contour) # Executa os ejemplos dispon√≠veis da fun√ß√£o
browseVignettes() # Mostra na web as vinhetas disponn√≠veis e o acesso
# a elas. De um pacote: (package="package-name")
vignette(all=TRUE) # Mostra todas as vinhetas dispon√≠veis na tela
```

## 

```{=html}
<iframe width="1400" height="800"             src="images/mean.html" title="help example"></iframe>
```
## 

#### Elementos da ficha t√©cnica de uma fun√ß√£o

+--------------+------------------------------------------------+-------------------------------------------------------------------------+
|              | Name:                                          | o nome da fun√ß√£o (entre chaves `{}` o pacote ao qual pertence a fun√ß√£o) |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| Description: | Breve descri√ß√£o da fun√ß√£o                      |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| Usage:       | Sintaxe da fun√ß√£o                              |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| Arguments:   | Argumentos                                     |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| Value:       | Valores                                        |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| References:  | Refer√™ncias                                    |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| See Also:    | Fun√ß√µes relacionadas                           |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+
| Examples:    | Exemplos de como se usa a fun√ß√£o               |                                                                         |
+--------------+------------------------------------------------+-------------------------------------------------------------------------+

## 

#### Ajuda externa

A comunidade R √© muito ativa, por isso √© muito f√°cil na web encontrar em qualquer motor de busca a solu√ß√£o para os problemas que surgem num fluxo de trabalho.

De maneira geral se destacam estas p√°ginas:

<http://search.r-project.org/>

<https://www.rdocumentation.org/>

<https://rseek.org/>

[https://stackover ow.com/questions/tagged/r](https://stackover%20ow.com/questions/tagged/r)

<https://stats.stackexchange.com/questions/tagged/r>

##
### Iniciar uma sess√£o no R {#iniciar-sessao-no-r}

#### Comandos b√°sicos (I)

```{r, echo=TRUE}
ls() # lista os objetos que est√£o na mem√≥ria em ".GlobalEnv"
```

```{r, echo=TRUE}
y <- c(1, 5, 9) # cria um objeto que contem 3 n√∫meros
y
```

```{r}
ls()
```

```{r, echo=TRUE, eval=FALSE}
rm(y) # elimina (remove) o objeto 

```

```{r, echo=TRUE, eval=TRUE}
objects() # idem ls()
```

```{r, echo=TRUE}
rm(list=ls(all=TRUE)) # elimina todos os objetos da sess√£o de trabalho
```

## 

#### Alguns comandos b√°sicos (II)

```{r, echo=FALSE, eval=FALSE}
setwd() # establece directorio de trabajo
getwd() # devuelve la ruta actual
dir() # lista os arquivos no diret√≥rio
list.files() # idem anterior
dir.create() # cria um diret√≥rio
```

##### Exemplos

```{r, eval=FALSE, echo=TRUE}
# Op√ß√£o 1
setwd("C:/Users/usuario/Desktop/Curso_R") # Usar: nn ou /

# Op√ß√£o 2
directorio1 <- "C:/Users/usuario/Desktop/Curso_R"
setwd(directorio1)
dir.create("../Curso_R/Plots")
directorio2 <- "../Curso_R/Plots"
setwd(directorio2)
```

## 

##### Exemplos

Este fluxo de trabalho tem seus problemas (ver esta discuss√£o e estes pacotes: [aqui](https://cran.r-project.org/web/packages/here/index.html) e [rprojroot](https://cran.r-project.org/web/packages/rprojroot/index.html)

## 

#### `options()`

Esta fun√ß√£o permite modificar diversas op√ß√µes sobre a forma como R calcula e exibe resultados.

```{r, echo=TRUE, eval=TRUE}
names(options())
```

## 

A fun√ß√£o `options()` permite o usu√°rio definir e examinar op√ß√µes globais.\
As op√ß√µes afetam a maneira como R calcula e exibe seus resultados.

`digits`: n√∫mero de digitos significativos a serem impressos

```{r, echo=TRUE, eval=FALSE, `code-line-numbers`="1|4-5"}
100/654
## [1] 0.1529052

options(digits = 4)
100/654
## [1] 0.1529
```

## 

`width`: Lagura do texto de sa√≠da

```{r, echo=TRUE, eval=FALSE, `code-line-numbers`="1-2|5-7"}
set.seed(1234)
rnorm(8)
## [1] -1.2071  0.2774  1.0844 -2.3457  0.4291  0.5061 -0.5747 -0.5466

options(width = 40)
set.seed(1234)
rnorm(8)
## [1] -1.2071  0.2774  1.0844 -2.3457
## [5]  0.4291  0.5061 -0.5747 -0.5466
```

## 

#### Erros e advert√™ncias em R

**Importante:**

-   Quando aparece uma mensagem de erro ou de alerta √© preciso investigar!

-   A principal diferen√ßa entre um erro e um aviso √© que o erro n√£o produz um nenhum resultado, enquanto um aviso o faz.\

## 

#### Executando fun√ß√µes no R

```{r, echo = TRUE, eval = FALSE, `code-line-numbers`="1|4-5|8|11|14"}
mean(variable.1)
## Error in mean(variable.1): object 'variable.1' not found

variable.1 <- seq(1, 100, 0.3)
mean(variable1)
## Error in mean(variable1): object 'variable1' not found

mean(variable.1)
## [1] 50.5

sqt(8)
## Error in sqt(8): could not find function "sqt"

sqrt(8)
## [1] 2.828
```

## 

#### Instru√ß√µes de uso das fun√ß√µes

Quando se usa uma fun√ß√£o:

-   Os argumentos que tem valores incorretos podem n√£o ser chamados quando a fun√ß√£o √© executada.
-   Os argumentos tem uma ordem que deve ser seguida se o usu√°rio optar por n√£o nome√°-los.
-   Os argumentos podem ser colocados em ordem personalizada mas devem ser nomeados.\
    \
    Todas estas op√ß√µes geram o mesmo resultado:\

```{r, echo= TRUE, eval=FALSE}
mean(x = 1:10)
mean(1:10)
mean(x = c(1:10, NA), trim = 0, na.rm = TRUE)
mean(trim = 0, x = c(1:10, NA), na.rm = TRUE)
mean(c(1:10, NA), 0, TRUE)
## [1] 5.5
```
##
### Refer√™ncias extras {#sec-refer√™ncias}

::: incremental
-   The R Foundation \[homepage on the Internet\]. Vienna, Austria: R Foundation for Statistical Computing. The R Project for Statistical Computing. Available from: [¬ª https://www.r-project.org](https://www.r-project.org/)

-   Grolemund G. Hands-On Programming with R \[monograph on the Internet\]. Sebastopol, CA: O‚ÄôReilly Media; 2014. Available from: [¬ª https://rstudio-education.github.io/hopr](https://rstudio-education.github.io/hopr)
:::

## 2. Uso do R no levantamento geoqu√≠mico

-   Etapa I - Planejamento das esta√ß√µes de coleta

-   Etapa II - Organiza√ß√£o dos dados do Levantamento Geoqu√≠mico

-   Etapa III - Avalia√ß√£o dos dados anal√≠ticos

-   Etapa IV - An√°lise explorat√≥ria dos dados

##

### Etapa I planejamento de esta√ß√µes

-   [Trabalhando com fei√ß√µes espaciais](#trabalhando-com-fei√ß√µes-espaciais)
-   [Importando a imagem SRTM](#importando-a-imagem-srtm)
-   [Planejando as esta√ß√µes de coleta](#planejando-as-esta√ß√µes-de-coleta)
-   [Mapa das esta√ß√µes planejadas](#mapa-das-esta√ß√µes-planejadas)
-   [Modelagem das bacias e valida√ß√£o das esta√ß√µes planejadas](#modelagem-das-bacias-e-valida√ß√£o-das-esta√ß√µes-planejadas)
-   [Mapa de planejamento validado](#mapa-de-planejamento_validado)
##

#### Trabalhando com fei√ß√µes espaciais {#trabalhando-com-fei√ß√µes-espaciais}

```{r var1, echo=FALSE}
rios <- "rios_ibge.shp"
massa_dagua <- "massa_dagua.shp"
area_urbana <- "area_urbana.shp"
limite <- "carta_100M.shp"
limite_srtm <- "area_srtm.shp"
dir_in <- "inputs/campo/"
bacia_minima <- 4
bacia_maxima <- 25
snap_dist <- "0.02"
threshold <- 250
min_length <- "0.02"
max_ordem <- 3
wbt_wd <- "outputs/modelo/"
EPSG <- 4326
dir_out <- "outputs/"
tipo_base <- 1
base_campo <- "fcampo"
dir_os <- "inputs/os/" 
```

```{r feicoes_model, results='hide'}
bases_model <-
  digeoqR::gera_bases_model(dir_in, limite,
                            limite_srtm, area_urbana,
                            rios, massa_dagua)
```
##
#### Importando a imagem SRTM {#importando-a-imagem-srtm}

```{r srtm, message = FALSE, results='hide'}
dem <- digeoqR::prepara_dem()
```
##
#### Planejando as esta√ß√µes de coleta {#planejando-as-esta√ß√µes-de-coleta}

```{r plan, results='hide'}
 gera_est <- 
 digeoqR::gera_estacoes(dem, dir_out, 
                        bases_model, 
                        EPSG, threshold, 
                        min_length, 
                        max_ordem, wbt_wd) 
```
##
#### Mapa das esta√ß√µes planejadas {#mapa-das-esta√ß√µes-planejadas}

```{r mapa_est_plan, echo=FALSE}
plot(gera_est$mapa)
```
##

#### Modelagem das bacias e valida√ß√£o das esta√ß√µes planejadas {#modelagem-das-bacias-e-valida√ß√£o-das-esta√ß√µes-planejadas}

```{r model_bacias_plan, results='hide'}
fase <- 1
classe_am <- 2

modela_bacias_plan <-
  digeoqR::modela_bacias(fase, EPSG, dem, bases_model, 
                         gera_est, ex_campo, classe_am, 
                         bacia_minima, bacia_maxima, 
                         threshold, snap_dist, 
                         min_length, max_ordem, 
                         dir_out, wbt_wd)

```
##
#### Mapa de planejamento validado {#mapa-de-planejamento_validado}

```{r plan_mapa, echo=FALSE}
plot(modela_bacias_plan$`mapa plan`)
```
##
### Etapa II Organiza√ß√£o dos dados do Levantamento Geoqu√≠mico

-   [Importa√ß√£o dos dados de campo (FCAMPO, SUVEY123, QFIELD)](#importa√ß√£o-dos-dados-de-campo-fcampo-suvey123-qfield)

-   [Modelagem das bacias amostradas](#modelagem-das-bacias-amostradas)

-   [Visualiza√ß√£o do mapa de esta√ß√µes amostradas e bacias](#visualiza√ß√£o-do-mapa-de-esta√ß√µes-amostradas-e-bacias)

-   [Importa√ß√£o dos dados anal√≠ticos](#importa√ß√£o-dos-dados-anal√≠ticos)

    -   Sedimento de corrente

    -   Concentrado de bateia

-   [Organiza√ß√£o os dados anal√≠ticos](#organiza√ß√£o-dos_dados_anal√≠ticos)

-   [Enriquecimento as bases com fei√ß√µes espaciais (geologia)](#enriquecimento-das-bases-com-fei√ß√µes-espaciais-geologia)
##
#### Importa√ß√£o dos dados de campo (FCAMPO, SUVEY123, QFIELD) {#importa√ß√£o-dos-dados-de-campo-fcampo-suvey123-qfield}

```{r dados_campo, results='hide'}
ex_campo <- digeoqR::extrai_dados_campo(tipo_base,
                                        dir_in,
                                        base_campo,
                                        dir_os,
                                        EPSG,
                                        dir_out)
```
##
#### Modelagem das bacias amostradas {#modelagem-das-bacias-amostradas}

-   Sedimento de corrente\
-   Concentrado de bateia

## 

##### Sedimento de corrente

```{r sed_cor}

fase <- 2
classe_am <- 2

modela_bacias_sc <-
  digeoqR::modela_bacias(fase, EPSG, dem, bases_model, 
                         gera_est, ex_campo, classe_am, 
                         bacia_minima, bacia_maxima, 
                         threshold, snap_dist, min_length, 
                         max_ordem, dir_out, wbt_wd)
```

## 

##### Concentrado de bateia

```{r conc_bat}

fase <- 2
classe_am <- 1

modela_bacias_cb <-
  digeoqR::modela_bacias(fase, EPSG, dem, bases_model, 
                         gera_est, ex_campo, classe_am, 
                         bacia_minima, bacia_maxima, 
                         threshold, snap_dist, min_length, 
                         max_ordem, dir_out, wbt_wd)
```
##
#### Visualiza√ß√£o do mapa de esta√ß√µes amostradas e bacias {#visualiza√ß√£o-do-mapa-de-esta√ß√µes-amostradas-e-bacias}

-   Sedimento de corrente\
-   Concentrado de bateia

## 

##### Sedimento de corrente

```{r mapa_am_sc, echo=FALSE}
plot(modela_bacias_sc$`mapa amostragem`)
```

## 

##### Concentrado de Bateia

```{r mapa_am_cb, echo=FALSE}
plot(modela_bacias_cb$`mapa amostragem`)
```
##
#### Importa√ß√£o dos dados anal√≠ticos {#importa√ß√£o-dos-dados-anal√≠ticos}

Nessa rotina os dados dos boletins s√£o lidos e arrumados em dois formatos:\
- dados brutos (sem substitui√ß√£o dos qualificadores)\
- dados transformados (substitui√ß√£o \<LD por 0,5\*LD)\

## 

##### Sedimento de corrente

```{r analises_sc, results='hide'}

dir_bol <- "inputs/quimica/S/"; analise <- 2; 
dir_ucc <- "inputs/quimica/"; ref_ucc <- "ucc.csv";
classe_am <- 2

quimica <- 
  digeoqR::le_boletim_quimica(classe_am, dir_bol,
                              dir_ucc, ref_ucc)
```

## 

##### Concentrado de bateia

```{r analises_cb, results='hide'}
dir_bol <- "inputs/mineral/B/"

mineral <- 
  digeoqR::le_boletim_mineral(dir_bol)
```

##
#### Organiza√ß√£o dos dados anal√≠ticos {#organiza√ß√£o-dos_dados_anal√≠ticos}

##### Sedimento de corrente

```{r base_sc, results='hide', message=FALSE}

dir_bol <- "inputs/quimica/S/"
analise <- 2
classe_am <- 2

base_sc <- 
  digeoqR::prepara_bases(dir_bol, classe_am, 
                         analise,quimica, 
                         mineral, ex_campo)
```

## 

###### Base preparada - Sedimento de corrente

```{r tab_base_sc, echo=FALSE}
dados_sc <- base_sc[["dados brutos"]]
rmarkdown::paged_table(dados_sc, options = list(rows.print = 9, cols.print = 5))
```

## 

##### Concentrado de bateia

```{r base_cb, results='hide', message=FALSE}
# 
dir_bol <- "inputs/mineral/B/"
analise <- 1
classe_am <- 1
base_cb <- 
  digeoqR::prepara_bases(dir_bol, classe_am, 
                         analise,quimica, 
                         mineral, ex_campo)
```

## 

###### Base preparada - Concentrado de bateia

```{r tab_base_cb, echo=FALSE}
dados_cb <- base_cb[["dados brutos"]]
rmarkdown::paged_table(dados_cb, options = list(rows.print = 9, cols.print = 5))
```
##
#### Enriquecimento das bases com fei√ß√µes espaciais (geologia) {#enriquecimento-das-bases-com-fei√ß√µes-espaciais-geologia}

-   Extrai dados xml cores da layer (QGIS)\
-   Visualiza cores das unidades geradas\
-   Prepara recorte da geologia e estilo de cores\
-   Prepara legenda da geologia\
-   Mapa geol√≥gico simplificado\
-   Faz a intersec√ß√£o entre bacias e geologia

## 

##### Extrai dados xml cores da layer (QGIS)

```{r mapas_base}

legenda_geol <- 
  digeoqR::resgata_legenda_xml()

```

## 

##### Visualiza cores das unidades geradas

```{r echo=FALSE}
rmarkdown::paged_table(head(legenda_geol[,-1]))
```

## 

##### Prepara o recorte da geologia e estilo de cores

```{r recorte_geol, results='hide'}

feicao_in <- "geologia_br"; feicao_out <- "geologia_area";
dir_in <- "inputs/campo/"; area <- "area_srtm"
chave <- "RANGE"

geologia <- 
  digeoqR::recorta_feicao_area(dir_in, dir_out, 
                               area, feicao_in,
                               feicao_out, chave)
```

## 

##### Prepara a legenda da geologia

```{r leg_geo, results='hide'}

lista_legenda <- 
  digeoqR::prepara_legenda(feicao_rec = geologia, 
                           dir_out, 
                           dir_in, 
                           nome_xml = "geologia")
```

## 

##### Mapa geol√≥gico simplificado

```{r mapa_geol, echo=FALSE}
leg1 <- lista_legenda[[1]]
leg2 <- lista_legenda[[2]]
estacoes <- ex_campo[["esta√ß√µes"]]
estacoes <- estacoes[estacoes$CLASSE == "Sedimento de corrente",]
ggplot2::ggplot() +
  ggplot2::geom_sf(data=geologia, ggplot2::aes(fill = RANGE)) + 
  ggplot2::geom_sf(data=estacoes, color = "black", shape = 1) + 
  ggplot2::scale_fill_manual(values=leg2$RGB, breaks=leg2$SIGLA) +
  ggplot2::theme_minimal()+
  ggspatial::annotation_scale(location = "br", style = "ticks") +
  ggspatial::annotation_north_arrow(location = "bl")

```

## 

##### Faz a intersec√ß√£o entre bacias e geologia

```{r inters_bacias, results='hide'}

bacias <- modela_bacias_sc[["bacias"]]
estacoes <- base_sc[["dados campo sf"]]
feicao_rec <- geologia
nome_xml <- "geologia"
classe_am <- 2
tipo_leg <- 2

lito_bacia_sc <-
  digeoqR::intersecta_bacias(dir_in,
                             dir_out, bases_model,
                             bacias, feicao_rec,
                             tipo_leg, estacoes,
                             classe_am, nome_xml)
   
```

##
### Etapa III Avalia√ß√£o dos dados anal√≠ticos

-   [An√°lise dos dados censurados √† esquerda](#dados-censurados-√†-esquerda)

-   [An√°lise dos valores ausentes](#an√°lise-dos-valores-ausentes)

-   [Testes estat√≠sticos (dados brutos)](#testes-estat√≠sticos)

    -   Normalidade (Shapiro-Wilker e Lillie-Fors\
    -   Comparativo (Wilcolxon n√£o pareado)\

-   [QAQC das duplicatas de campo e replicatas de laborat√≥rio](#qaqc-das-duplicatas-de-campo-e%20replicatas-de-laborat√≥rio)

    -   Duplicatas de campo\
    -   Replicatas de laborat√≥rio

-   [Estat√≠stica descritiva](#estat√≠stica-descritiva) \##
##
#### An√°lise dos dados censurados √† esquerda {#an√°lise-dos-dados-censurados-√†-esquerda}

```{r analise_elem,  results='hide'}
corte_val = 70
base <- base_sc
res_val <- digeoqR::validacao_elementos(dir_out, base, corte_val)
```
\

#### Elementos V√°lidos (grau de detec√ß√£o \>70%)

```{r elem_val, echo= FALSE }
elem_val = res_val[[2]]
rmarkdown::paged_table(data.frame('Elementos' = paste(elem_val, collapse=", ")))
```

## 

#### N√∫mero de dados v√°lidos por analito

```{r n_validos, echo = FALSE}
nmld <- res_val[[1]][, c("elementos", "nneg")]
colnames(nmld) <- c("Analito", "N. V√°lidos")
rmarkdown::paged_table(nmld, 
                       options = list(rows.print = 9))
```

## 

#### An√°lise dos valores ausentes {#an√°lise-dos-valores-ausentes}

```{r ausentes, echo = FALSE}
nmna <- res_val[[1]][, c("elementos", "nna")]
colnames(nmna) <- c("Analito", "N. Ausentes")
rmarkdown::paged_table(nmna, 
                       options = list(rows.print = 9))
```

#### Testes estat√≠sticos (dados brutos) {#testes-estat√≠sticos}

```{r test_brutos, echo=FALSE, results='hide'}
lito_bacia <- lito_bacia_sc; leg <- leg2; base <- base_sc

teste_mtd_transf1 <-
  digeoqR::testes_estatisticos(dir_out, base, lito_bacia, mtd_transf = 1, nbc = 10, leg, elem_val )
```

##### Teste Shapiro-Wilker

```{r vis_sw_brutos, echo=FALSE}

teste_sw <- teste_mtd_transf1[['test. norm. Shapiro-Wilk unidades']]
 
rmarkdown::paged_table(teste_sw, 
                       options = list(rows.print = 9, cols.print = 5))
```

## 

##### Teste Lillie-Fors

```{r lf_brutos, echo=FALSE}
teste_lf <- teste_mtd_transf1[["test. norm. Lillie geral"]]
rmarkdown::paged_table(teste_lf, 
                       options = list(rows.print = 9, cols.print = 5))
```

## 

##### Teste Wilcoxon

```{r prep_vis_wilcoxon, results='hide'}
vis_wilcolxon <- 
  digeoqR::vis_teste_wilcox(dir_out, elem_val,base, 
                            lito_bacia, nbc = 10)
```

## 

###### Visualiza√ßao do teste Wilcoxon do Alum√≠nio

```{r vis_wx_al, echo = FALSE}
gridExtra::grid.arrange(grobs = vis_wilcolxon[c(1,length(vis_wilcolxon))],  
                         ncol = 2,
                         top = grid::textGrob(""),
                         gp=gpar(fontsize=12,font=3))
```
##
#### QAQC das duplicatas de campo e replicatas de labor√≥rio {#qaqc-das-duplicatas-de-campo-e replicatas-de-laborat√≥rio}

-   Campo\
-   Laborat√≥rio

## 

##### Duplicatas de campo

```{r qaqc_campo, results='hide'}
base <- base_sc
tipo_am = 1
qaqc <- digeoqR::qaqc_gq(dir_out, base, tipo_am)
```

## 

###### Gr√°fico Thompson-Howard

```{r vis_TH_campo, echo=FALSE}
gridExtra::grid.arrange(grobs=qaqc[["gr√°fico com texto"]]["Al"], ncol = 1)
```

## 

###### Tabela de precis√£o das duplicatas de campo

```{r tab_precisao_campo, echo=FALSE}
table_grid <- gridExtra::tableGrob(qaqc[["df tabela de precis√£o"]], rows = NULL, theme = gridExtra::ttheme_default(base_size = 20))
gridExtra::grid.arrange(table_grid)
```

## 

##### Replicatas de laborat√≥rio

```{r qaqc_lab, results='hide'}
base <- base_sc
tipo_am = 2
qaqc <- digeoqR::qaqc_gq(dir_out, base, tipo_am)
```

## 

###### Gr√°fico Thompson-Howard

```{r vis_TH_lab, echo=FALSE}
gridExtra::grid.arrange(grobs=qaqc[["gr√°fico com texto"]]["Al"], ncol = 1)
```

## 

###### Tabela de precis√£o das replicatas de laborat√≥rio

```{r tab_precisao_lab, echo=FALSE}
table_grid <- gridExtra::tableGrob(qaqc[["df tabela de precis√£o"]], rows = NULL, theme = gridExtra::ttheme_default(base_size = 20))
gridExtra::grid.arrange(table_grid)
```

##
#### Estat√≠stica descritiva {#estat√≠stica-descritiva}

##### Geral

```{r stat_geral, results='hide'}

rotulo_lito <- lito_bacia_sc[[2]]
base <- base_sc
tipo_proc <- 1

tabela_estat_g_sc <- 
  digeoqR::tabela_estatistica(tipo_proc,
                              rotulo_lito, base,
                              lista_legenda, dir_out)

```

## 

###### Visualiza√ß√£o do sum√°rio estat√≠stico - Elementos

```{r vis_sum_stat_geral1, echo=FALSE}
stat_transposta_g_sc <- tabela_estat_g_sc[[1]]
colnames(stat_transposta_g_sc) <- stat_transposta_g_sc[2,]
stat_transposta_g_sc <- data.frame(stat_transposta_g_sc)
rmarkdown::paged_table(stat_transposta_g_sc, options = list(rows.print = 9, cols.print = 5))
```

## 

###### Visualiza√ß√£o do sum√°rio estat√≠stico - Par√¢metros

```{r vis_sum_stat_geral2, echo=FALSE}
stat_normal_g_sc <- tabela_estat_g_sc[[2]]
rmarkdown::paged_table(stat_normal_g_sc, options = list(rows.print = 9, cols.print = 5))
```

## 

##### Agrupado

```{r stat_unid, results='hide'}

tipo_proc = 2

tabela_estat_a_sc <-
  digeoqR::tabela_estatistica(tipo_proc,
                              rotulo_lito,
                              base, lista_legenda, dir_out)

```

## 

###### Visualiza√ß√£o do sum√°rio estat√≠stico - Elementos

```{r vis_sum_stat_unid1, echo=FALSE}

stat_normal_a_sc <- tabela_estat_a_sc[[2]]
stat_normal_a_sc <- data.frame(stat_normal_a_sc, check.names = FALSE)
rmarkdown::paged_table(stat_normal_a_sc, options = list(rows.print = 9, cols.print = 5))
```

## 

###### Visualiza√ß√£o do sum√°rio estat√≠stico - Par√¢metros

```{r vis_sum_stat_unid2, echo=FALSE}
stat_transposta_a_sc <- tabela_estat_a_sc[[1]]
colnames(stat_transposta_a_sc) <- stat_transposta_a_sc[2,]
stat_transposta_a_sc <- data.frame(stat_transposta_a_sc, check.names = FALSE)
elementos <- unique(colnames(stat_transposta_a_sc))
elementos <- elementos[!is.na(elementos)]
stat_transposta_a_sc <- stat_transposta_a_sc %>%
 dplyr::select(elementos) 
rmarkdown::paged_table(stat_transposta_a_sc, options = list(rows.print = 9, cols.print = 5))
```
##
### Etapa IV An√°lise Explorat√≥ria dos dados
  -   Classifica√ß√£o de todas as amostras
  -   Classifica√ß√£o das amostras agrupadas por unidade geol√≥gica
  -   Mapa geoqu√≠mico
  
##
#### Classifica√ß√£o de todas as amostras

\
M√©todo de classifica√ß√£o: MAD

```{r mad_tudo, eval = TRUE, echo=TRUE}
cl_mtd_mad <- digeoqR::classifica_metodos(tipo_proc = 1, mtd_class = 1,
                                          lito_bacia, elem_val, base, nbc = 10)
```

\
M√©todo de classifica√ß√£o: TIF

```{r tif_tudo, eval = TRUE, echo=TRUE}
cl_mtd_tif <- 
  digeoqR::classifica_metodos(tipo_proc = 1, mtd_class = 2,
                              lito_bacia, elem_val, base, nbc = 10)
```

\
M√©todo de classifica√ß√£o: C-A

```{r , eval = TRUE, echo=TRUE}
cl_mtd_ca <- 
  digeoqR::classifica_metodos(tipo_proc = 1, mtd_class = 3,
                              lito_bacia, elem_val, base, nbc = 10)
```

## 

#### Classifica√ß√£o das amostras agrupadas por unidade geol√≥gica

\
M√©todo de classifica√ß√£o: MAD

```{r, eval = TRUE, echo=TRUE}
cl_mtd_mad_un <- 
  digeoqR::classifica_metodos(tipo_proc = 2, mtd_class = 1,
                              lito_bacia, elem_val, base, nbc = 10)
```

\
M√©todo de classifica√ß√£o: TIF

```{r, eval = TRUE, echo=TRUE}
cl_mtd_tif_un <- 
  digeoqR::classifica_metodos(tipo_proc = 2, mtd_class = 2,
                              lito_bacia, elem_val, base, nbc = 10)
```

\
M√©todo de classifica√ß√£o: C-A

```{r, eval = TRUE, echo=TRUE}
cl_mtd_ca_un <- 
  digeoqR::classifica_metodos(tipo_proc = 2, mtd_class = 3,
                              lito_bacia, elem_val, base, nbc = 10)
```

## 

##### Tabela de dados classificados ex: TIF - todas as amostras

```{r}
rmarkdown::paged_table(cl_mtd_tif)

```

## 

#### Mapa Geoqu√≠mico - TIF

```{r , echo=FALSE, eval=TRUE}

names( modela_bacias_sc)

bacias <- modela_bacias_sc[["bacias"]]

dados_transf <- base_sc[[2]]

litho_max <- lito_bacia_sc[[2]]

 leg <- leg2
 
 tipo_leg <- 2
 
 info_bol <- quimica$`informa√ß√£o do boletim`

```

```{r mapa_tif, echo=TRUE, eval=TRUE, results='hide'}
 mapas_tif_un <- 
  digeoqR::mapa_tif_unidades(bacias, geologia, dados_transf,
                             info_bol, litho_max, nbc=10,
                             elem_val, tipo_leg, leg )

```

## 

```{r, echo=FALSE, eval=TRUE}
 plot(mapas_tif_un$mapas[[4]])
```

## 3. Fechamento

-   Minhas impress√µes do uso do R.

-   Qual os pr√≥ximos passos?

-   Feedback dos participantes.
